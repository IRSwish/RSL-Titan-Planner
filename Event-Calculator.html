<div style="margin:10px 0;">
  <button id="toggle-display">Afficher en %</button>
</div>

<div id="points-table-container" class="hidden">
  <table id="points-table">
    <thead>
      <tr>
        <th>Rarity</th>
        <th>Rank 1 ⭐</th>
        <th>Rank 2 ⭐</th>
        <th>Rank 3 ⭐</th>
        <th>Rank 4 ⭐</th>
        <th>Rank 5 ⭐</th>
        <th>Rank 6 ⭐</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>Common</td></tr>
      <tr><td>Uncommon</td></tr>
      <tr><td>Rare</td></tr>
      <tr><td>Epic</td></tr>
      <tr><td>Legendary</td></tr>
      <tr><td>Mythical</td></tr>
    </tbody>
  </table>
</div>

<script>
let pointsData = {}; // ton JSON complet (points + loot)
let displayMode = 'points'; // 'points' ou 'percent'

// Récupérer les éléments
const eventTypeSelect = document.getElementById('event-type');
const zoneSelect = document.getElementById('zone');
const dungeonDifficulty = document.getElementById('dungeon-difficulty');
const dungeonStage = document.getElementById('dungeon-stage');

const pointsTableContainer = document.getElementById('points-table-container');
const pointsTableBody = document.getElementById('points-table').querySelector('tbody');

const rarities = ['Common', 'Uncommon', 'Rare', 'Epic', 'Legendary', 'Mythical'];

// Charger le JSON
fetch('/points-data.json')
  .then(res => res.json())
  .then(data => { pointsData = data; })
  .catch(err => console.error('Erreur chargement points:', err));

// Bouton toggle
const toggleBtn = document.getElementById('toggle-display');
toggleBtn.addEventListener('click', () => {
  displayMode = displayMode === 'points' ? 'percent' : 'points';
  toggleBtn.textContent = displayMode === 'points' ? 'Afficher en %' : 'Afficher en points';
  const eventType = eventTypeSelect.value;
  if(eventType) fillPointsTable(eventType);
  if(zoneSelect.value) fillLootTable();
});

// Générer tableau vide
function generateEmptyPointsTable() {
  pointsTableBody.innerHTML = '';
  rarities.forEach(rarity => {
    const tr = document.createElement('tr');
    const tdRarity = document.createElement('td');
    tdRarity.textContent = rarity;
    tr.appendChild(tdRarity);

    for(let i=1;i<=6;i++){
      const td = document.createElement('td');
      td.textContent = '0';
      tr.appendChild(td);
    }
    pointsTableBody.appendChild(tr);
  });
}

// Remplir tableau points (événements)
function fillPointsTable(eventType){
  if(!pointsData.points[eventType]) return;
  rarities.forEach((rarity,rowIndex)=>{
    const tr = pointsTableBody.rows[rowIndex];
    for(let col=1;col<=6;col++){
      let value = pointsData.points[eventType][rarity][col-1];
      let display = displayMode === 'percent' ? value + '%' : value;
      tr.cells[col].textContent = display;

      // Styles
      if(value==0){
        tr.cells[col].style.color = '#888'; // gris
        tr.cells[col].style.backgroundColor = '';
      } else {
        tr.cells[col].style.color = displayMode==='percent' ? '#fff' : '#000';
        const alpha = value/Math.max(...pointsData.points[eventType][rarity]);
        tr.cells[col].style.backgroundColor = `rgba(0,200,0,${Math.min(alpha*0.5,0.35)})`; // vert léger
      }
    }
  });
}

// Remplir tableau loot (dungeon/campaign)
function fillLootTable(){
  const zone = zoneSelect.value;
  const diff = dungeonDifficulty.value;
  const stage = dungeonStage.value;
  if(!pointsData.loot[zone] || !pointsData.loot[zone][diff] || !pointsData.loot[zone][diff][stage]) return;

  const lootStage = pointsData.loot[zone][diff][stage];
  rarities.forEach((rarity,rowIndex)=>{
    const tr = pointsTableBody.rows[rowIndex];
    for(let col=1;col<=6;col++){
      const value = lootStage[rarity][col-1];
      const display = displayMode==='percent' ? (value*100).toFixed(2)+'%' : value;
      tr.cells[col].textContent = display;

      // Styles
      if(value==0){
        tr.cells[col].style.color = '#666'; // gris encore plus foncé
        tr.cells[col].style.backgroundColor = '';
      } else {
        tr.cells[col].style.color = '#fff';
        const alpha = value/Math.max(...lootStage[rarity]);
        tr.cells[col].style.backgroundColor = `rgba(0,200,0,${Math.min(alpha*0.5,0.35)})`;
      }
    }
  });
}

// Événements select
eventTypeSelect.addEventListener('change',()=>{
  const val = eventTypeSelect.value;
  if(val){
    pointsTableContainer.classList.remove('hidden');
    generateEmptyPointsTable();
    fillPointsTable(val);
  } else {
    pointsTableContainer.classList.add('hidden');
  }
});

dungeonDifficulty.addEventListener('change',()=>{fillLootTable();});
dungeonStage.addEventListener('change',()=>{fillLootTable();});

// Initialisation
generateEmptyPointsTable();
</script>
