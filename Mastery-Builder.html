<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Swish - RSL Tools | Mastery Builder</title>
  <link rel="stylesheet" href="style/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8653563887265027" crossorigin="anonymous"></script>

  <style>
  #builder {
    display: flex;
    justify-content: center;
    gap: 40px;
    flex-wrap: wrap;
    margin: 40px auto;
    max-width: 1400px;
  }

  .tree {
    background: var(--event-bg);
    border: 2px solid var(--event-border);
    border-radius: 12px;
    padding: 20px 20px 40px;
    width: 340px;
    text-align: center;
    box-shadow: 0 0 10px rgba(212,175,55,0.2);
    position: relative;
  }

  .tree h2 {
    font-family: 'American Captain';
    color: var(--line-color);
    font-size: 24px;
    margin-bottom: 15px;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    justify-items: center;
    position: relative;
  }

  /* --- OCTOGONES --- */
  .mastery {
    width: 70px;
    height: 70px;
    background: #1a1a1a;
    border: 2px solid #555;
    clip-path: polygon(
      30% 0%, 70% 0%, 100% 30%, 100% 70%,
      70% 100%, 30% 100%, 0% 70%, 0% 30%
    );
    transition: all 0.2s ease;
    cursor: pointer;
    position: relative;
    z-index: 2;
  }

  .mastery:hover {
    box-shadow: 0 0 10px rgba(212,175,55,0.3);
  }

  .mastery.active {
    border-color: var(--line-color);
    box-shadow: 0 0 12px var(--line-color);
    background: radial-gradient(circle at center, rgba(212,175,55,0.15), #1a1a1a);
  }

  /* --- CONNEXIONS --- */
  .connection {
    position: absolute;
    width: 4px;
    height: 60px;
    background: rgba(212,175,55,0.15);
    left: 50%;
    transform: translateX(-50%);
    z-index: 1;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .connection.active {
    background: linear-gradient(to bottom, #d4af37, #fce39b);
    box-shadow: 0 0 12px #d4af37;
    opacity: 1;
  }

  .buttons {
    text-align: center;
    margin-top: 25px;
  }

  .buttons button {
    background: linear-gradient(145deg, #1a1a1a, #2b2b2b);
    border: 2px solid var(--event-border);
    color: var(--text-color);
    font-weight: 600;
    font-size: 15px;
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    margin: 0 10px;
    transition: all 0.2s ease;
  }

  .buttons button:hover {
    transform: scale(1.05);
    box-shadow: 0 0 8px var(--event-border);
  }
  </style>
</head>
<body>
  <div id="menu-container"></div>

  <div class="header-wrapper">
    <header id="page-title">Mastery Builder</header>
  </div>

  <div id="builder">
    <div class="tree" data-branch="offense">
      <h2>Attaque</h2>
      <div class="grid"></div>
    </div>

    <div class="tree" data-branch="defense">
      <h2>Défense</h2>
      <div class="grid"></div>
    </div>

    <div class="tree" data-branch="support">
      <h2>Soutien</h2>
      <div class="grid"></div>
    </div>
  </div>

  <div class="buttons">
    <button id="copy-link">Copier le lien</button>
    <button id="reset">Réinitialiser</button>
  </div>

  <p id="share-link" style="margin-top:10px; font-size:14px; font-style:italic;"></p>

<script>
document.addEventListener('DOMContentLoaded', () => {

  // ---- GÉNÉRATION DES MAÎTRISES ----
  const layout = [2, 4, 4, 4, 4, 4]; // nombre de maîtrises par ligne
  document.querySelectorAll('.tree').forEach(tree => {
    const branch = tree.dataset.branch;
    const grid = tree.querySelector('.grid');
    layout.forEach((cols, row) => {
      const startCol = cols < 4 ? Math.ceil((4 - cols) / 2) + 1 : 1;
      for (let col = 0; col < cols; col++) {
        const div = document.createElement('div');
        div.className = 'mastery';
        div.dataset.id = `${branch}-${row + 1}-${col + 1}`;
        div.title = `Maîtrise ${branch} ${row + 1}-${col + 1}`;
        if (cols < 4) div.style.gridColumn = `${startCol + col} / span 1`;
        grid.appendChild(div);

        // ajout de la connexion sauf pour la dernière ligne
        if (row < layout.length - 1) {
          const conn = document.createElement('div');
          conn.className = 'connection';
          conn.dataset.from = `${branch}-${row + 1}-${col + 1}`;
          conn.dataset.to = `${branch}-${row + 2}-${col + 1}`;
          grid.appendChild(conn);
        }
      }
    });
  });

  // ---- GESTION DES SÉLECTIONS ----
  const masteryEls = document.querySelectorAll('.mastery');
  const copyBtn = document.getElementById('copy-link');
  const resetBtn = document.getElementById('reset');
  const shareLink = document.getElementById('share-link');
  const connections = document.querySelectorAll('.connection');

  masteryEls.forEach(el => {
    el.addEventListener('click', () => {
      el.classList.toggle('active');
      updateConnections();
      updateLink();
    });
  });

  // --- met à jour les liens entre maîtrises ---
  function updateConnections() {
    connections.forEach(line => {
      const from = document.querySelector(`[data-id="${line.dataset.from}"]`);
      const to = document.querySelector(`[data-id="${line.dataset.to}"]`);
      if (from && to && from.classList.contains('active') && to.classList.contains('active')) {
        line.classList.add('active');
      } else {
        line.classList.remove('active');
      }
    });
  }

  // --- génère le lien partageable ---
  function updateLink() {
    const activeIds = [...document.querySelectorAll('.mastery.active')].map(el => el.dataset.id);
    const encoded = btoa(activeIds.join(','));
    const link = `${window.location.origin}${window.location.pathname}?m=${encoded}`;
    shareLink.textContent = link;
  }

  // --- copie du lien ---
  copyBtn.addEventListener('click', () => {
    navigator.clipboard.writeText(shareLink.textContent);
    copyBtn.textContent = 'Lien copié ✅';
    setTimeout(() => (copyBtn.textContent = 'Copier le lien'), 1500);
  });

  // --- reset ---
  resetBtn.addEventListener('click', () => {
    document.querySelectorAll('.mastery.active').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.connection.active').forEach(el => el.classList.remove('active'));
    shareLink.textContent = '';
    history.replaceState(null, '', window.location.pathname);
  });

  // --- décodage depuis le lien ---
  const params = new URLSearchParams(window.location.search);
  if (params.has('m')) {
    const data = atob(params.get('m')).split(',');
    data.forEach(id => document.querySelector(`[data-id="${id}"]`)?.classList.add('active'));
    updateConnections();
    updateLink();
  }
});
</script>

<script src="script.js"></script>
</body>
</html>
