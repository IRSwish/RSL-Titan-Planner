<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Swish - RSL Tools | Mastery Builder</title>
  <link rel="stylesheet" href="style/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8653563887265027" crossorigin="anonymous"></script>

  <style>
  #builder {
    display: flex;
    justify-content: center;
    gap: 40px;
    flex-wrap: wrap;
    margin: 40px auto;
    max-width: 1400px;
  }

  .tree {
    background: var(--event-bg);
    border: 2px solid var(--event-border);
    border-radius: 12px;
    padding: 20px;
    width: 340px;
    text-align: center;
    box-shadow: 0 0 10px rgba(212,175,55,0.2);
  }

  .tree h2 {
    font-family: 'American Captain';
    color: var(--line-color);
    font-size: 24px;
    margin-bottom: 15px;
  }

  /* 4 colonnes / 6 lignes, mais la première ligne a seulement 2 maîtrises */
  .grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 14px;
    justify-items: center;
  }

  .row {
    display: contents;
  }

  /* Octogones */
  .mastery {
    width: 70px;
    height: 70px;
    background: #1a1a1a;
    border: 2px solid #555;
    clip-path: polygon(
      30% 0%, 70% 0%, 100% 30%, 100% 70%,
      70% 100%, 30% 100%, 0% 70%, 0% 30%
    );
    transition: all 0.2s ease;
    cursor: pointer;
  }

  .mastery:hover {
    box-shadow: 0 0 10px rgba(212,175,55,0.3);
  }

  .mastery.active {
    border-color: var(--line-color);
    box-shadow: 0 0 12px var(--line-color);
    background: radial-gradient(circle at center, rgba(212,175,55,0.15), #1a1a1a);
  }

  .buttons {
    text-align: center;
    margin-top: 25px;
  }

  .buttons button {
    background: linear-gradient(145deg, #1a1a1a, #2b2b2b);
    border: 2px solid var(--event-border);
    color: var(--text-color);
    font-weight: 600;
    font-size: 15px;
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    margin: 0 10px;
    transition: all 0.2s ease;
  }

  .buttons button:hover {
    transform: scale(1.05);
    box-shadow: 0 0 8px var(--event-border);
  }
  </style>
</head>
<body>
  <div id="menu-container"></div>

  <div class="header-wrapper">
    <header id="page-title">Mastery Builder</header>
  </div>

  <div id="builder">
    <div class="tree" data-branch="offense">
      <h2>Attaque</h2>
      <div class="grid"></div>
    </div>

    <div class="tree" data-branch="defense">
      <h2>Défense</h2>
      <div class="grid"></div>
    </div>

    <div class="tree" data-branch="support">
      <h2>Soutien</h2>
      <div class="grid"></div>
    </div>
  </div>

  <div class="buttons">
    <button id="copy-link">Copier le lien</button>
    <button id="reset">Réinitialiser</button>
  </div>

  <p id="share-link" style="margin-top:10px; font-size:14px; font-style:italic;"></p>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Génère dynamiquement 6 lignes / 4 colonnes (sauf la première à 2 centrées)
  document.querySelectorAll('.tree').forEach(tree => {
    const branch = tree.dataset.branch;
    const grid = tree.querySelector('.grid');
    for (let row = 1; row <= 6; row++) {
      const columns = row === 1 ? 2 : 4; // première ligne : 2 maîtrises
      const startCol = row === 1 ? 2 : 1; // centrées
      for (let col = 0; col < columns; col++) {
        const div = document.createElement('div');
        div.className = 'mastery';
        div.dataset.id = `${branch}-${row}-${col + 1}`;
        div.title = `Maîtrise ${branch} ${row}-${col + 1}`;
        // alignement visuel de la première ligne
        if (row === 1) div.style.gridColumn = `${startCol + col} / span 1`;
        grid.appendChild(div);
      }
    }
  });

  const masteryEls = document.querySelectorAll('.mastery');
  const copyBtn = document.getElementById('copy-link');
  const resetBtn = document.getElementById('reset');
  const shareLink = document.getElementById('share-link');

  // Toggle activation
  masteryEls.forEach(el => {
    el.addEventListener('click', () => {
      el.classList.toggle('active');
      updateLink();
    });
  });

  // Génère le lien
  function updateLink() {
    const activeIds = [...document.querySelectorAll('.mastery.active')].map(el => el.dataset.id);
    const encoded = btoa(activeIds.join(','));
    const link = `${window.location.origin}${window.location.pathname}?m=${encoded}`;
    shareLink.textContent = link;
  }

  // Copie
  copyBtn.addEventListener('click', () => {
    navigator.clipboard.writeText(shareLink.textContent);
    copyBtn.textContent = 'Lien copié ✅';
    setTimeout(() => (copyBtn.textContent = 'Copier le lien'), 1500);
  });

  // Reset
  resetBtn.addEventListener('click', () => {
    document.querySelectorAll('.mastery.active').forEach(el => el.classList.remove('active'));
    shareLink.textContent = '';
    history.replaceState(null, '', window.location.pathname);
  });

  // Décodage si lien existant
  const params = new URLSearchParams(window.location.search);
  if (params.has('m')) {
    const data = atob(params.get('m')).split(',');
    data.forEach(id => document.querySelector(`[data-id="${id}"]`)?.classList.add('active'));
    updateLink();
  }
});
</script>

<script src="script.js"></script>
</body>
</html>
